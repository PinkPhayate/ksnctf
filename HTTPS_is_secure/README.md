# HTTPS is secure.

## outline
TLSv1でやりとりされている通信相手の公開鍵情報から、秘密鍵を取得。  
秘密鍵を生成してから、Wiresharkで通信パケット上のデータを復号してフラグを取得する。  



## 公開鍵情報の取得

1. TLS1.0通信の「Handshake Protocol: Certificate」でやりとりされているパケット上の公開鍵情報を取得する。
2. パケット上のCertificates情報は複数ある場合があるが、サーバ証明書、中間証明書A、 中間証明書B、ルート証明書の順に並んでいるので、通信相手のサーバ証明書を取得するには先頭の証明書情報から公開鍵情報を取得する
3. publicExponentとして証明書情報と一緒に記載されている情報も秘密鍵の生成に必要になる。


## 秘密鍵を生成する
パケットファイルでは、2つのサーバと通信を行っていて、相互サーバの公開鍵情報が同じ素数を使ってRSA鍵を生成している事をついて、秘密鍵を求める。

1. 2つのサーバの公開鍵情報から取得した値の最大公約数を求め、素数1を取得。
2. 公開鍵情報は2つの素数の積でできているため、素数2も取得。
3. 証明書に記載されていたpublicExponentを公開指数として、拡張ユークリッドの互除法を使って秘密鍵指数を計算(`euclidean.py`)
4. 公開鍵情報と秘密鍵情報を用いてPEM方式の秘密鍵を生成する(`create_secretkey.py`)


## 画像データを復号する
画像ファイル(JPEG)は通信パケット上で「jfif」というフォーマットのデータでやりとりされる。そのため、人間が画像として認識できるようにするためには変換を行う必要がある(`convert_jfif.py`)。  
